<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Crear cuenta</title>

  <link rel="stylesheet" href="/FightZone/css/styles.css">
  <style>
    .auth-page { display: flex; justify-content: center; padding: 64px 16px; }
    .auth { width: 100%; max-width: 460px; }
    .auth__title { margin: 0 0 16px; }
    .auth__card { border-radius: 12px; padding: 24px; border: 1px solid rgba(0,0,0,0.12); background: transparent;
      display:block!important; opacity:1!important; visibility:visible!important; position:relative; z-index:2; pointer-events:auto; }
    .auth .form-group { margin-bottom: 14px; }
    .auth label { display: block; margin-bottom: 6px; font-weight: 600; }
    .auth .input { width: 100%; }
    .auth .btn-primary { width: 100%; margin-top: 8px; }
    .auth .helper { display: block; margin-top: 10px; font-size: .95rem; opacity: .85; }
    .auth .error { color: #ff5252; margin-top: 8px; }
    .auth .success { color: #4caf50; margin-top: 8px; }
    .auth, .auth * { animation:none!important; transition:none!important; }
  </style>
</head>
<body>
  <main class="auth-page">
    <section class="auth">
      <h1 class="auth__title h2">Crear cuenta</h1>

      <div class="auth__card">
        <form id="form-registro" novalidate>
          <div class="form-group">
            <label for="reg-nombre">Nombre</label>
            <input id="reg-nombre" name="name" type="text" class="input" required placeholder="Tu nombre">
          </div>

          <div class="form-group">
            <label for="reg-email">Correo electrónico</label>
            <input id="reg-email" name="email" type="email" class="input" required autocomplete="email" placeholder="tuemail@dominio.com">
          </div>

          <div class="form-group">
            <label for="reg-password">Contraseña</label>
            <input id="reg-password" name="password" type="password" class="input" required minlength="8" autocomplete="new-password" placeholder="Mínimo 8 caracteres">
          </div>

          <div class="form-group">
            <label for="reg-password2">Repite la contraseña</label>
            <input id="reg-password2" name="password2" type="password" class="input" required placeholder="Repite la contraseña">
          </div>

          <button type="submit" class="btn btn-primary">Crear cuenta</button>

          <div id="registro-feedback" class="helper"></div>
        </form>
      </div>
    </section>
  </main>

  <script>
    (function(){
      const form = document.getElementById('form-registro');
      const feedback = document.getElementById('registro-feedback');
      const show = (m,c='helper') => { feedback.textContent=m; feedback.className=c; };

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        show('');
        const name = document.getElementById('reg-nombre').value.trim();
        const email = document.getElementById('reg-email').value.trim();
        const p1 = document.getElementById('reg-password').value;
        const p2 = document.getElementById('reg-password2').value;

        if (!name || !email || !p1 || !p2) return show('Por favor, completa todos los campos.', 'error');
        if (p1.length < 8) return show('La contraseña debe tener al menos 8 caracteres.', 'error');
        if (p1 !== p2) return show('Las contraseñas no coinciden.', 'error');

        try {
          const res = await fetch('/api/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, email, password: p1 })
          });
          let data = {}; try { data = await res.json(); } catch {}

          if (!res.ok) throw new Error(data?.message || 'Error al registrar.');

          show('Cuenta creada. Iniciando sesión…', 'success');
          setTimeout(() => { window.location.href = '/mi-cuenta'; }, 700);
        } catch (err) {
          show(err.message || 'No se pudo conectar con el servidor.', 'error');
        }
      });
    })();
  </script>
</body>
</html>